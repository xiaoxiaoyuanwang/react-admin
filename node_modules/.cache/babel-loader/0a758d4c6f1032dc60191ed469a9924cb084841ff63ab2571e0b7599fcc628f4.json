{"ast":null,"code":"var _jsxFileName=\"E:\\\\myWorkSpace\\\\webpack_react_cli\\\\src\\\\components\\\\Transform\\\\index.jsx\",_s=$RefreshSig$();// index.js\nimport React,{useState,useEffect}from\"react\";import{Switch}from\"antd\";import{CloseCircleOutlined}from\"@ant-design/icons\";import\"./index.scss\";import moment from\"moment\";import transform_icon from\"../../assets/transform/transform_icon.png\";import transform_bg from\"../../assets/transform/transform_bg.jpeg\";Storage.prototype.setExpire=(key,value,expire)=>{let obj={data:value,time:Date.now(),expire:expire};//localStorage 设置的值不能为对象,转为json字符串\nlocalStorage.setItem(key,JSON.stringify(obj));};Storage.prototype.getExpire=key=>{let val=localStorage.getItem(key);if(!val){return val;}val=JSON.parse(val);if(Date.now()-val.time>val.expire){localStorage.removeItem(key);return null;}return val.data;};const Transform=()=>{_s();let storage=localStorage.getExpire(`floatFlag`);if(storage===\"false\"||storage===false){storage=false;}else{storage=true;}const[floatFlag,setFloatFlag]=useState(storage);// burst\nconst[showBurst,setShowBurst]=useState(false);// burst path\nconst[pathBurst,setPathBurst]=useState(\"\");// burst time\nconst[timeBurst,setTimeBurst]=useState(\"\");const[showFloat,setShowFloat]=useState(false);const[showBtn,setShowBtn]=useState(false);const[floatList,setFloatList]=useState([]);const[tableList,setTableList]=useState([]);useEffect(()=>{getTableList();},[]);useEffect(()=>{initStyle();},[tableList]);const getTableList=()=>{let list=[{showoption:\"btn\",starttime:\"2022-09-03\",endtime:\"2023-09-03\",imagaddress:[{path:transform_icon}]},{showoption:\"burst\",starttime:\"2022-09-03\",endtime:\"2023-09-03\",imagaddress:[{path:transform_bg}]},{showoption:\"float\",starttime:\"2022-09-03\",endtime:\"2023-09-03\",imagaddress:[{path:transform_icon},{path:transform_icon}]},{showoption:\"header\",starttime:\"2022-09-03\",endtime:\"2023-09-03\",imagaddress:[{path:transform_bg}]}];setTableList(list);};// 获取七条数据\nconst initList=(data,cb)=>{if(data&&data.length<7){let dt=data.concat(data);initList(dt,cb);}else{cb(data.slice(0,7));}};const add0=m=>{return m<10?\"0\"+m:m;};const initStyle=()=>{try{let tableLs=JSON.parse(JSON.stringify(tableList));let resDt=[];let time=new Date();var y=time.getFullYear();var m=time.getMonth()+1;var d=time.getDate();var H=time.getHours();var FEN=time.getMinutes();var Miao=time.getSeconds();let newDe=moment(`${y}-${add0(m)}-${add0(d)} ${add0(H)}:${add0(FEN)}:${add0(Miao)}`).format(\"YYYY-MM-DD HH:mm:ss\");for(let index=0;index<tableLs.length;index++){const element=tableLs[index];let strDe=moment(`${element.starttime} 00:00:00`).format(\"YYYY-MM-DD HH:mm:ss\");let endDe=moment(`${element.endtime} 23:59:59`).format(\"YYYY-MM-DD HH:mm:ss\");if(moment(strDe).isBefore(moment(newDe))&&moment(newDe).isBefore(moment(endDe))){resDt.push(element);// break;\n}}if(resDt&&resDt.length>0){for(let idx=0;idx<resDt.length;idx++){const element=resDt[idx];if(element.showoption===\"float\"){let str=element.imagaddress;let list=[];initList(str,dt=>{list=dt;});setShowFloat(true);setShowBtn(true);setFloatList(list);}else if(element.showoption===\"btn\"){let strBtn=element.imagaddress[0].path;let sty=`\n              .ant-btn::before {\n                  content: \" \";\n                  display: block;\n                  background: url(${strBtn}) no-repeat!important;\n                  background-size: 20px !important;\n                  height: 100%;\n                  width: 100%;\n                  position: absolute;\n                  top: -10px;\n                  left: -10px;\n                  opacity: 1;\n              }\n              `;loadStyleString(sty);}else if(element.showoption===\"burst\"){let tmZl=`${y}-${add0(m)}-${add0(d)}`;let flag=true;if(localStorage.getExpire(`timeBurstLocal`)===`${tmZl}`){flag=false;}setShowBurst(flag);setPathBurst(element.imagaddress[0].path);setTimeBurst(tmZl);}else if(element.showoption===\"header\"){let strH=element.imagaddress[0].path;let styH=`\n              .ant-pro-global-header {\n                background-image: url(${strH});\n                background-repeat: no-repeat;\n                background-size: cover;\n                // opacity: 0.8;\n              }\n              `;loadStyleString(styH);}}}else{setShowFloat(false);setShowBtn(false);setFloatFlag(false);setFloatList([]);}}catch(error){setShowFloat(false);setShowBtn(false);setFloatFlag(false);setFloatList([]);console.log(error);}};const loadStyleString=css=>{var style=document.createElement(\"style\");style.type=\"text/css\";try{style.appendChild(document.createTextNode(css));}catch(ex){style.styleSheet.cssText=css;//兼容IE\n}var head=document.getElementsByTagName(\"head\")[0];head.appendChild(style);};// burst关闭\nconst CloseBurst=()=>{setShowBurst(false);// 有效期两天\nlocalStorage.setExpire(`timeBurstLocal`,`${timeBurst}`,86400000*2);};// 调用示例\n// loadStyleString(\"body{background-color:red}\");\nconst selectHtml=()=>{if(showFloat&&floatFlag){return/*#__PURE__*/React.createElement(React.Fragment,{__self:this,__source:{fileName:_jsxFileName,lineNumber:231,columnNumber:9}},floatList?floatList.map((item,index)=>{let width=Math.round(Math.random()*20+30);return/*#__PURE__*/React.createElement(\"div\",{key:index,className:`animation${index+1}`,__self:this,__source:{fileName:_jsxFileName,lineNumber:236,columnNumber:19}},/*#__PURE__*/React.createElement(\"img\",{alt:\"\\u56FE\\u7247\",width:width,src:item.path,__self:this,__source:{fileName:_jsxFileName,lineNumber:237,columnNumber:21}}));}):\"\");}else{return null;}};// 调用示例\nconst selectHtmlBurst=()=>{var tempHeightRight=document.documentElement.clientHeight-100;if(showBurst&&pathBurst){return/*#__PURE__*/React.createElement(React.Fragment,{__self:this,__source:{fileName:_jsxFileName,lineNumber:253,columnNumber:9}},/*#__PURE__*/React.createElement(\"div\",{onClick:()=>{CloseBurst();},className:\"shadeWrapper\",style:{cursor:\"pointer\"},__self:this,__source:{fileName:_jsxFileName,lineNumber:254,columnNumber:11}},/*#__PURE__*/React.createElement(\"div\",{onClick:()=>{CloseBurst();},className:\"shadeClose\",__self:this,__source:{fileName:_jsxFileName,lineNumber:261,columnNumber:13}},/*#__PURE__*/React.createElement(CloseCircleOutlined,{__self:this,__source:{fileName:_jsxFileName,lineNumber:267,columnNumber:15}})),/*#__PURE__*/React.createElement(\"div\",{__self:this,__source:{fileName:_jsxFileName,lineNumber:269,columnNumber:13}},/*#__PURE__*/React.createElement(\"img\",{alt:\"\\u56FE\\u7247\",style:{maxHeight:tempHeightRight},src:pathBurst,__self:this,__source:{fileName:_jsxFileName,lineNumber:270,columnNumber:15}}))));}else{return null;}};// 开启/关闭特效\nconst switchCheck=e=>{// 有效期七天\nlocalStorage.setExpire(`floatFlag`,e,86400000*7);setFloatFlag(e);};return/*#__PURE__*/React.createElement(React.Fragment,{__self:this,__source:{fileName:_jsxFileName,lineNumber:290,columnNumber:5}},/*#__PURE__*/React.createElement(\"div\",{__self:this,__source:{fileName:_jsxFileName,lineNumber:291,columnNumber:7}},showBtn),showBtn?/*#__PURE__*/React.createElement(\"div\",{style:{display:\"inline-block\",position:\"fixed\",top:\"23px\",right:\"100px\",zIndex:\"31\"},__self:this,__source:{fileName:_jsxFileName,lineNumber:293,columnNumber:9}},/*#__PURE__*/React.createElement(Switch,{checkedChildren:\"\\u5173\\u95ED\\u7279\\u6548\",unCheckedChildren:\"\\u5F00\\u542F\\u7279\\u6548\",checked:floatFlag,onChange:e=>switchCheck(e),__self:this,__source:{fileName:_jsxFileName,lineNumber:302,columnNumber:11}})):null,selectHtmlBurst(),selectHtml());};_s(Transform,\"zYX3jqbb8+R5Hc3zmly7PtC4g+w=\");_c=Transform;export default Transform;var _c;$RefreshReg$(_c,\"Transform\");","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}