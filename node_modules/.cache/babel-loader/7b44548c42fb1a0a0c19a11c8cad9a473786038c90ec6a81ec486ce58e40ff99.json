{"ast":null,"code":"var _jsxFileName=\"E:\\\\myWorkSpace\\\\webpack_react_cli\\\\src\\\\components\\\\Transform\\\\index.jsx\";// index.js\nimport React,{PureComponent}from\"react\";import{Switch}from\"antd\";import{CloseCircleOutlined}from\"@ant-design/icons\";import\"./index.scss\";import moment from\"moment\";import transform_icon from\"../../assets/transform/transform_icon.png\";import transform_bg from\"../../assets/transform/transform_bg.png\";Storage.prototype.setExpire=(key,value,expire)=>{let obj={data:value,time:Date.now(),expire:expire};//localStorage 设置的值不能为对象,转为json字符串\nlocalStorage.setItem(key,JSON.stringify(obj));};Storage.prototype.getExpire=key=>{let val=localStorage.getItem(key);if(!val){return val;}val=JSON.parse(val);if(Date.now()-val.time>val.expire){localStorage.removeItem(key);return null;}return val.data;};export default class Transform extends PureComponent{constructor(props){super(props);let storage=localStorage.getExpire(`floatFlag`);if(storage==\"false\"||storage==false){storage=false;}else{storage=true;}this.state={showBurst:false,// burst\npathBurst:\"\",// burst path\ntimeBurst:\"\",// burst time\nshowFloat:false,showBtn:false,floatFlag:storage,floatList:[]};}componentDidMount(){this.getTableList();}// 获取七条数据\ninitList(data,cb){if(data&&data.length<7){let dt=data.concat(data);this.initList(dt,cb);}else{cb(data.slice(0,7));}}// 获取列表\ngetTableList(){let list=[{showoption:\"btn\",starttime:\"2022-09-03\",endtime:\"2023-09-03\",imagaddress:[{path:transform_icon}]},{showoption:\"burst\",starttime:\"2022-09-03\",endtime:\"2023-09-03\",imagaddress:[{path:transform_bg}]},{showoption:\"float\",starttime:\"2022-09-03\",endtime:\"2023-09-03\",imagaddress:[{path:transform_icon},{path:transform_icon}]},{showoption:\"header\",starttime:\"2022-09-03\",endtime:\"2023-09-03\",imagaddress:[{path:transform_bg}]}];this.setState({tableList:list},()=>{this.initStyle();});}add0(m){return m<10?\"0\"+m:m;}initStyle(){try{let tableList=JSON.parse(JSON.stringify(this.state.tableList));let resDt=[];let time=new Date();var y=time.getFullYear();var m=time.getMonth()+1;var d=time.getDate();var H=time.getHours();var FEN=time.getMinutes();var Miao=time.getSeconds();let newDe=moment(`${y}-${this.add0(m)}-${this.add0(d)} ${this.add0(H)}:${this.add0(FEN)}:${this.add0(Miao)}`).format(\"YYYY-MM-DD HH:mm:ss\");for(let index=0;index<tableList.length;index++){const element=tableList[index];let strDe=moment(`${element.starttime} 00:00:00`).format(\"YYYY-MM-DD HH:mm:ss\");let endDe=moment(`${element.endtime} 23:59:59`).format(\"YYYY-MM-DD HH:mm:ss\");if(moment(strDe).isBefore(moment(newDe))&&moment(newDe).isBefore(moment(endDe))){resDt.push(element);// break;\n}}if(resDt&&resDt.length>0){for(let idx=0;idx<resDt.length;idx++){const element=resDt[idx];if(element.showoption==\"float\"){let str=element.imagaddress;let list=[];this.initList(str,dt=>{list=dt;});this.setState({showFloat:true,showBtn:true,floatList:list});}else if(element.showoption==\"btn\"){let strBtn=element.imagaddress[0].path;let sty=`\n              .ant-btn::before {\n                  content: \" \";\n                  display: block;\n                  background: url(${strBtn}) no-repeat!important;\n                  background-size: 20px !important;\n                  height: 100%;\n                  width: 100%;\n                  position: absolute;\n                  top: -10px;\n                  left: -10px;\n                  opacity: 1;\n              }\n              `;let sty2=`\n              .ant-btn::before {\n                  content: \" \";\n                  display: block;\n                  background: transparent!important;\n                  background-size: 20px !important;\n                  height: 100%;\n                  width: 100%;\n                  position: absolute;\n                  top: -10px;\n                  left: -10px;\n                  opacity: 1;\n              }\n              `;this.loadStyleString(sty);}else if(element.showoption==\"burst\"){let tmZl=`${y}-${this.add0(m)}-${this.add0(d)}`;let flag=true;if(localStorage.getExpire(`timeBurstLocal`)==`${tmZl}`){flag=false;}this.setState({showBurst:flag,pathBurst:element.imagaddress[0].path,timeBurst:tmZl});}else if(element.showoption==\"header\"){let strH=element.imagaddress[0].path;let styH=`\n              .ant-pro-global-header {\n                background-image: url(${strH});\n                background-repeat: no-repeat;\n                background-size: cover;\n                // opacity: 0.8;\n              }\n              `;this.loadStyleString(styH);}}}else{this.setState({showFloat:false,showBtn:false,floatFlag:false,floatList:[]});}}catch(error){this.setState({showFloat:false,showBtn:false,floatFlag:false,floatList:[]});}}loadStyleString(css){var style=document.createElement(\"style\");style.type=\"text/css\";try{style.appendChild(document.createTextNode(css));}catch(ex){style.styleSheet.cssText=css;//兼容IE\n}var head=document.getElementsByTagName(\"head\")[0];head.appendChild(style);}// burst关闭\nCloseBurst(){this.setState({showBurst:false,timeBurstLocal:this.state.timeBurst},()=>{// 有效期两天\nlocalStorage.setExpire(`timeBurstLocal`,`${this.state.timeBurstLocal}`,86400000*2);});}// 调用示例\n// 　　loadStyleString(\"body{background-color:red}\");\nselectHtml(){if(this.state.showFloat&&this.state.floatFlag){return/*#__PURE__*/React.createElement(React.Fragment,{__self:this,__source:{fileName:_jsxFileName,lineNumber:272,columnNumber:9}},this.state.floatList?this.state.floatList.map((item,index)=>{let width=Math.round(Math.random()*20+30);return/*#__PURE__*/React.createElement(\"div\",{key:index,className:`animation${index}`,__self:this,__source:{fileName:_jsxFileName,lineNumber:277,columnNumber:19}},/*#__PURE__*/React.createElement(\"img\",{width:width,src:item.path,__self:this,__source:{fileName:_jsxFileName,lineNumber:278,columnNumber:21}}));}):\"\");}else{return null;}}// 调用示例\nselectHtmlBurst(){var tempHeightRight=document.documentElement.clientHeight-100;if(this.state.showBurst&&this.state.pathBurst){return/*#__PURE__*/React.createElement(React.Fragment,{__self:this,__source:{fileName:_jsxFileName,lineNumber:294,columnNumber:9}},/*#__PURE__*/React.createElement(\"div\",{onClick:()=>{this.CloseBurst();},className:\"shadeWrapper\",style:{cursor:\"pointer\"},__self:this,__source:{fileName:_jsxFileName,lineNumber:295,columnNumber:11}},/*#__PURE__*/React.createElement(\"div\",{onClick:()=>{this.CloseBurst();},className:\"shadeClose\",__self:this,__source:{fileName:_jsxFileName,lineNumber:302,columnNumber:13}},/*#__PURE__*/React.createElement(CloseCircleOutlined,{__self:this,__source:{fileName:_jsxFileName,lineNumber:308,columnNumber:15}})),/*#__PURE__*/React.createElement(\"div\",{__self:this,__source:{fileName:_jsxFileName,lineNumber:310,columnNumber:13}},/*#__PURE__*/React.createElement(\"img\",{style:{maxHeight:tempHeightRight},src:this.state.pathBurst,__self:this,__source:{fileName:_jsxFileName,lineNumber:311,columnNumber:15}}))));}else{return null;}}// 开启/关闭特效\nswitchCheck(e){// 有效期七天\nlocalStorage.setExpire(`floatFlag`,e,86400000*7);this.setState({floatFlag:e},()=>{console.log(\"e\",e);// this.initStyle();\n});}render(){return/*#__PURE__*/React.createElement(React.Fragment,{__self:this,__source:{fileName:_jsxFileName,lineNumber:339,columnNumber:7}},this.state.showBtn?/*#__PURE__*/React.createElement(\"div\",{style:{display:\"inline-block\",position:\"fixed\",top:\"10px\",right:\"300px\",zIndex:\"31\"},__self:this,__source:{fileName:_jsxFileName,lineNumber:341,columnNumber:11}},/*#__PURE__*/React.createElement(Switch,{checkedChildren:\"\\u5173\\u95ED\\u7279\\u6548\",unCheckedChildren:\"\\u5F00\\u542F\\u7279\\u6548\",checked:this.state.floatFlag,onChange:e=>this.switchCheck(e),__self:this,__source:{fileName:_jsxFileName,lineNumber:350,columnNumber:13}})):null,this.selectHtmlBurst(),this.selectHtml());}}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}