{"ast":null,"code":"var _jsxFileName=\"E:\\\\myWorkSpace\\\\webpack_react_cli\\\\src\\\\services\\\\request.js\";// 引入依赖\nimport axios from\"axios\";import{Modal,message}from\"antd\";import{ExclamationCircleOutlined}from\"@ant-design/icons\";import{loadingActions}from\"../redux/actions/loadingActions\";import store from\"../redux\";const{confirm}=Modal;const request=axios.create({headers:{\"Content-Type\":\"application/json;charset=UTF-8\"},timeout:500000// 请求超时时间\n});// loading函数\n// 记录请求次数\nlet needLoadingRequestCount=0;function startLoading(){loadingActions(true);}function endLoading(){// 延迟500ms，防止网速特快加载中画面一闪而过\nsetTimeout(function(){loadingActions(true);},500);}// 打开loading\nfunction showFullScreenLoading(){if(needLoadingRequestCount===0){startLoading();}needLoadingRequestCount++;}// 关闭loading\nfunction tryHideFullScreenLoading(){if(needLoadingRequestCount<=0)return;needLoadingRequestCount--;if(needLoadingRequestCount===0){endLoading();}}// request拦截器\nrequest.interceptors.request.use(config=>{// 打开loading\nshowFullScreenLoading();const token=localStorage.getItem(\"token\");if(token){// 判断是否存在token，如果存在的话，则每个http header都加上token\nconfig.headers.authorization=token;//请求头加上token\n}return config;},error=>{// 关闭loading\ntryHideFullScreenLoading();// Do something with request error\nPromise.reject(error);});// respone拦截器\nrequest.interceptors.response.use(response=>{// 关闭loading\ntryHideFullScreenLoading();const res=response.data;if(!res.data.success){// B002:Token 过期了;\nif(res.code===\"B002\"){// 最后一次出弹框\nif(needLoadingRequestCount===0){confirm({icon:/*#__PURE__*/React.createElement(ExclamationCircleOutlined,{__self:this,__source:{fileName:_jsxFileName,lineNumber:72,columnNumber:19}}),content:`你已被登出，可以取消继续留在该页面，\n            或者重新登录, 确定登出`,onOk(){// 返回登录页\n// ...做些事情\n// 为了重新实例化vue-router对象 避免bug\nwindow.location.href=\"/\";},onCancel(){console.log(\"Cancel\");}});}}else{message.error(res.msg);}return Promise.reject(res.msg||\"error\");}else{// 如果存在token\nlet token=response.headers.authorization;if(token){localStorage.setItem(\"token\",token);}return res;}},error=>{// 关闭loading\ntryHideFullScreenLoading();message.error(error);return Promise.reject(error);});export default request;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}